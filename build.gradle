apply plugin: 'java'

group = 'bottlerocketstuidos.automation'
version = '0.0.1-SNAPSHOT'

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
}

/*sourceSets {
    integTest {
        compileClasspath += test.java.smokeTest
        runtimeClasspath += main.output + test.output
    }
}*/

test {
    String uniqueFolder = "../automation_test_results/awe_framework/" + getFilterFolderName() + "/" + getDate() + "_" + project.gradle.startParameter.taskNames

    useTestNG {
        //suites 'src/test/java/smokeTest/awe_smoke_test.xml'
        useDefaultListeners = true
        //Use the unique name and the task name to create the folder
        reports.html.destination = file(uniqueFolder)
    }

    //Set these properties if they exist
    if(hasProperty('device_id')){
        systemProperty "CL_DEVICE_ID",deviceID
    }
    if(hasProperty('port')){
        systemProperty "CL_PORT",port
    }

    systemProperty "UNIQUE_FOLDER",uniqueFolder
    systemProperty "USE_GRADLE_VALUES","TRUE"

    // listen to events in the test execution lifecycle
    beforeTest { descriptor ->
        logger.lifecycle("Running test: " + descriptor)
    }

    // listen to standard out and standard error of the test JVM(s)
    onOutput { descriptor, event ->
        logger.lifecycle("Test: " + descriptor + " logged: " + event.message )
    }
}



def getDate() {
    def date = new Date()
    def formattedDate = date.format('MM_dd_yyyy HH_mm_ss a')
    return formattedDate
}

def getFilterFolderName() {
    def date = new Date()
    def month = date.format('MMMM_yy')
    return month
}



dependencies {
    compile project(':automation_library')
    compile group: 'io.appium', name: 'java-client', version:'3.4.0'
    //This isn't necessary since it comes included in Intellij, but unfortunately every time you synchronize the build.gradle you must tell it to add to the classpath again and it gets annoying
    compile group: 'org.testng', name: 'testng', version:'6.8.8'
}

/*task login(type: Test){
    testClassesDir = sourceSets.integTest.output.classesDir
    classpath = sourceSets.integTest.runtimeClasspath
}*/
